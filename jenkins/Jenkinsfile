pipeline {
    agent any
    parameters {
        choice(name: 'VERSION', choices: ['master', '1.0.1', '2.0.0-dev'], description: 'Satalertas branch')
        string(name: 'COMPOSE_PROJECT_NAME', defaultValue: 'develop', description: 'Compose project name (used on docker-compose "-p" parameter)')
        string(name: 'PROJECT_ID', defaultValue: 'mpmt', description: 'Project ID')
        string(name: 'BASE_URL', defaultValue: 'http://www.terrama2.dpi.inpe.br', description: 'Server url')
        string(name: 'BASE_PATH', defaultValue: 'develop', description: 'Server URL base path')
        booleanParam(name: 'DEPLOY', defaultValue: true, description: 'Should deploy after build?')
    }
    stages {
        stage('Build') {
            steps {
                echo 'Creating .env file..'
                sh './scripts/create-env.sh $VERSION $COMPOSE_PROJECT_NAME $PROJECT_ID $BASE_PATH $BASE_URL'
                echo 'Generating config files..'
                sh './scripts/generate-config.sh'
                echo 'Building images..'
                sh './scripts/build.sh'
                echo 'Pushing images to the registry..'
                sh './scripts/push.sh'
            }
        }
        stage('Test') {
            steps {
            }
        }
        stage('Deploy') {
            when {
                expression {
                    params.DEPLOY
                }
            }
            steps {

            }
        }
    }
}

